{"version":3,"sources":["../../../server/config/socketio.js"],"names":[],"mappings":"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","file":"socketio.js","sourcesContent":["/**\n * Socket.io configuration\n */\n'use strict';\n\nimport config from './environment';\nimport RoomEvents from '../api/room/room.events';\n\n//Model Events\nvar modelEvents = {\n  'newRequest':newRequest,\n  'newGroup':newGroup,\n  'deleteFriend':deleteFriend,\n  'tellFriendRemoved':tellFriendRemoved,\n  'tellFriendAccepted':tellFriendAccepted,\n  'joinRooms':joinRooms,\n  //'tellFriendRejected':tellFriendRejected,\n  'tellFriendExit':tellFriendExit,\n  'tellGroupDeleted':tellGroupDeleted,\n  'tellGroupAddedFriend':tellGroupAddedFriend\n};\n\n// When the user disconnects.. perform this\nfunction onDisconnect(socket) {\n}\n\n// When the user connects.. perform this\nfunction onConnect(socket) {\n  // When the client emits 'info', this listens and executes\n  socket.on('info', data => {\n    socket.log(JSON.stringify(data, null, 2));\n  });\n\n  var id=socket.decoded_token;\n\n  //Join own room\n  socket.join(id._id);\n\n  // Insert sockets below\n  require('../api/room/room.socket').register(socket,id);\n  require('../api/thing/thing.socket').register(socket);\n\n}\n/**\n * Socket leave room\n *  doc{\n *     id: socket id being removed\n *     roomId: room being disconnected\n *  }\n*/\nfunction leaveRoom (socket,userId,roomId){\n  var roomSockets= socket.nsps['/'].adapter.rooms[userId];\n\n  if(roomSockets)\n    for (var socketId in roomSockets.sockets) {\n      var _socket = socket.sockets.connected[socketId];\n      _socket.leave(roomId);\n    }\n}\n\n/**\n * Socket join room\n *  doc{\n *     id: socket id being removed\n *     roomId: room being disconnected\n *  }\n */\nfunction joinRoom(socket,userId,roomId){\n  var roomSockets= socket.nsps['/'].adapter.rooms[userId];\n  if(roomSockets)\n    for (var socketId in roomSockets.sockets) {\n      var _socket = socket.sockets.connected[socketId];\n      _socket.join(roomId);\n    }\n}\n\nfunction newRequest(socket,event) {\n  return function (doc) {\n    //joinRoom(socket,doc.toId,doc.from._id);\n    var message=\" You have a new friend request from \"+doc.from.email;\n    socket.to(doc.toId).emit(event, doc.from,message);\n    //socket.join(doc.from._id);\n  }\n}\n\n//Group behavior events\nfunction tellFriendRemoved(socket,event) {\n  return function (doc,info) {\n    //Socket's friend Leave Room\n    leaveRoom(socket,doc.friendId,doc.roomId);\n    //Message to friend\n    var message=info+\" kicked you out of \"+doc.groupName+\" conversation\";\n    socket.to(doc.friendId).emit(event, {roomId:doc.roomId,friendId:doc.friendId},message);\n    //Message to all other members\n    message=doc.friendName+\" was kicked out of \"+doc.groupName+\" conversation\";\n    socket.to(doc.roomId).emit(event, {roomId:doc.roomId,friendId:doc.friendId},message);\n    //socket.join(doc.from._id);\n  }\n}\n//Tell a group was deleted\nfunction tellGroupDeleted(socket,event) {\n  return function (doc,info) {\n\n    //Message to friend\n    var message=doc.groupName+\" was deleted by \"+doc.name;\n    socket.to(doc.roomId).emit(event,doc.roomId,message);\n    //socket.join(doc.from._id);\n    //Socket's Leave Room\n    leaveRoom(socket,doc.roomId,doc.roomId);\n  }\n}\n//Tell a group a friend was added\nfunction tellGroupAddedFriend(socket,event) {\n  return function (doc,info) {\n    //Message to the group members\n    message=\" Some people were added to \"+doc.groupName+\" conversation\";\n    socket.to(doc.roomId).emit(event,doc.roomId,message);\n    //Message to friend\n    var message=info+\" added you to \"+doc.groupName+\" conversation\";\n    Array.forEach(doc.membersId,(friendId)=>{\n      socket.to(friendId).emit(event,doc.roomId,message);\n      joinRoom(socket,friendId,doc.roomId);\n    });\n\n\n    //socket.join(doc.from._id);\n    //Socket's Leave Room\n\n  }\n}\n//Start Changing Here\nfunction tellFriendExit(socket,event) {\n  return function (doc) {\n    //Leave Room\n    leaveRoom(socket,doc.userId,doc.roomId);\n    //Message to be send\n    var message=doc.name+\" leave \"+doc.groupName+\" conversation\";\n    //Emit event to all other members\n    socket.to(doc.roomId).emit(event, {roomId:doc.roomId,friendId:doc.friendId},message);\n  }\n}\n//Group behavior events\nfunction tellFriendAccepted(socket,event) {\n  return function (doc) {\n    //Socket's friend join to Room\n    joinRoom(socket,doc.toId,doc.from._id);\n    //me join to Room\n    joinRoom(socket,doc.fromId,doc.from._id);\n    //Message to friend\n    var message=doc.from.members[0].name+\" accept your friend request \";\n    socket.to(doc.toId).emit(event,doc.from,message);\n  }\n}\n\n\nfunction newGroup(socket,event) {\n  return function (group,info) {\n    var message=info+\" added you to \"+group.name+\" group\";\n    var members=group.members;\n    for(var i=0;i<members.length;i++) {\n      joinRoom(socket,members[i]._id,group._id);\n      if(!group.admin.equals(members[i]._id))\n      socket.to(members[i]._id).emit(event, group, message);\n    }\n    joinRoom(socket,group.admin,group._id);\n  }\n}\n\nfunction deleteFriend(socket,event) {\n  return function (doc) {\n    var friendId=doc.friendId;\n    var message=doc.name+\" is no longer your friend\";\n    leaveRoom(socket,friendId,doc.roomId);\n    leaveRoom(socket,doc.userId,doc.roomId);\n    socket.to(friendId).emit(event,doc.roomId,message);\n\n  }\n}\n\n//Tell a group was deleted\nfunction joinRooms(socket,event) {\n  return function (doc) {\n    var roomSockets= socket.nsps['/'].adapter.rooms[doc.userId];\n    var _socket=null;\n    if(roomSockets) {\n      for (var socketId in roomSockets.sockets) {\n        _socket = socket.sockets.connected[socketId];\n\n      }\n      console.log(doc.rooms.length);\n      for(var i=0;i<doc.rooms.length;i++) {\n        console.log(\"room:changeStatus\",\n          doc.rooms[i]._id,\n          \" \"+_socket.request.session.name+\" is Online\");\n        if(doc.rooms[i].kind==\"par\")\n        _socket.to(doc.rooms[i]._id)\n          .emit(\n          \"room:changeStatus\",\n          doc.rooms[i]._id,\n          \" \"+_socket.request.session.name+\" is Online\"\n          );\n\n        //joinRoom(_socket,doc.userId,doc.rooms[i]._id);\n        _socket.join(doc.rooms[i]._id);\n      }\n    }\n  }\n}\n\nexport default function(socketio) {\n  // socket.io (v1.x.x) is powered by debug.\n  // In order to see all the debug output, set DEBUG (in server/config/local.env.js) to including the desired scope.\n  //\n  // ex: DEBUG: \"http*,socket.io:socket\"\n\n  // We can authenticate socket.io users and access their token through socket.decoded_token\n  //\n  // 1. You will need to send the token in `client/components/socket/socket.service.js`\n  //\n  // 2. Require authentication here:\n   socketio.use(require('socketio-jwt').authorize({\n     secret: config.secrets.session,\n     handshake: true\n  }));\n\n  socketio.use(function(socket, next) {\n    config.session(socket.request, socket.request.res, next);\n  });\n\n  //Subscribe socket.io events\n  for (let e in modelEvents) {\n    let callback = modelEvents[e];\n    RoomEvents.on(e, callback(socketio,'room:'+e));\n  }\n\n  socketio.on('connection', function(socket) {\n    socket.address = socket.request.connection.remoteAddress +\n      ':' + socket.request.connection.remotePort;\n\n    socket.connectedAt = new Date();\n\n    socket.log = function(...data) {\n      console.log(`SocketIO ${socket.nsp.name} [${socket.address}]`, ...data);\n    };\n\n    //********************************************************\n    //Verify already connected\n    var id=socket.decoded_token;\n    var roomSockets= socketio.nsps['/'].adapter.rooms[id._id];\n    var _socket=null;\n    if(roomSockets)\n      for (var socketId in roomSockets.sockets) {\n        _socket = socketio.sockets.connected[socketId];\n      }\n    if(_socket){\n      socket.to(id._id).emit(\"forceDisconnect\");\n      _socket.disconnect();\n    }\n\n    // Call onDisconnect.\n    socket.on('disconnect', () => {\n      onDisconnect(socket);\n      socket.log('DISCONNECTED');\n    });\n\n    // Call onConnect.\n    onConnect(socket);\n    socket.log('CONNECTED');\n  });\n}\n"]}